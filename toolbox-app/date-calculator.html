<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Êó•‰ªòË®àÁÆó„ÉÑ„Éº„É´ | „ÉÑ„Éº„É´„Éú„ÉÉ„ÇØ„Çπ</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto+Slab&display=swap');

  :root {
    --bg-light: #1e1e2f;
    --bg-light-darker: #292a40;
    --primary-light: #5567ab;
    --primary-light-hover: #7183d1;
    --text-light: #eef1f7;

    --bg-dark: #121221;
    --bg-dark-darker: #1b1b2f;
    --primary-dark: #7680d6;
    --primary-dark-hover: #8c95e5;
    --text-dark: #cfd1e6;
  }

  body[data-theme="light"] {
    --bg: var(--bg-light);
    --bg-darker: var(--bg-light-darker);
    --primary: var(--primary-light);
    --primary-hover: var(--primary-light-hover);
    --text: var(--text-light);
  }
  body[data-theme="dark"] {
    --bg: var(--bg-dark);
    --bg-darker: var(--bg-dark-darker);
    --primary: var(--primary-dark);
    --primary-hover: var(--primary-dark-hover);
    --text: var(--text-dark);
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    font-family: 'Roboto Slab', serif;
    background: var(--bg);
    color: var(--text);
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #themeToggleBtn {
    position: fixed;
    top: 12px;
    right: 12px;
    background: var(--primary);
    border: none;
    border-radius: 12px;
    color: var(--text);
    font-weight: 700;
    padding: 8px 14px;
    font-size: 1.2rem;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 3px 7px rgba(0,0,0,0.7);
    transition: background-color 0.3s ease;
    z-index: 1000;
  }
  #themeToggleBtn:hover {
    background-color: var(--primary-hover);
  }
  #themeToggleBtn:active {
    background-color: var(--primary);
  }

  #app {
    background: var(--bg);
    border-radius: 15px;
    width: 360px;
    max-width: 95vw;
    box-shadow: 0 8px 16px rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
    padding: 20px;
  }

  header {
    text-align: center;
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 16px;
    user-select: none;
  }

  .date-input {
    display: flex;
    gap: 8px;
    margin-bottom: 12px;
  }

  input[type="date"] {
    border-radius: 10px;
    border: none;
    padding: 8px;
    font-size: 1rem;
    background: var(--bg-darker);
    color: var(--text);
    outline: none;
    box-shadow: inset 2px 2px 5px rgba(0,0,0,0.6), inset -2px -2px 5px rgba(255,255,255,0.1);
    flex: 1;
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  button.add-btn {
    background: var(--primary);
    border: none;
    color: var(--text);
    font-weight: 700;
    padding: 8px 12px;
    border-radius: 12px;
    cursor: pointer;
    user-select: none;
    box-shadow: 0 3px 6px rgba(0,0,0,0.5);
    transition: background-color 0.3s ease;
  }
  button.add-btn:hover {
    background-color: var(--primary-hover);
  }
  button.remove-btn {
    background: #dc3545;
    border: none;
    color: #fff;
    border-radius: 8px;
    padding: 4px 8px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.3s ease;
    margin-left: 10px;
    flex-shrink: 0;
  }
  button.remove-btn:hover {
    background: #c82333;
  }
  .date-list {
    max-height: 150px;
    overflow-y: auto;
    background: var(--bg-darker);
    border-radius: 10px;
    padding: 8px;
    margin-bottom: 12px;
    color: var(--text);
    font-weight: 600;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  .date-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 4px 0;
  }
  .date-diff {
    margin-top: 12px;
    background: var(--bg-darker);
    border-radius: 10px;
    padding: 10px;
    max-height: 150px;
    overflow-y: auto;
    color: var(--text);
    font-weight: 600;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  .date-diff-item {
    padding: 4px 0;
  }
  @media (max-width: 380px), (max-height: 600px) {
    #app {
      width: 100vw;
      height: 100vh;
      border-radius: 0;
      padding: 16px 10px;
      box-sizing: border-box;
    }
    input[type="date"] {
      font-size: 0.9rem;
    }
    button.add-btn {
      padding: 6px 10px;
      font-size: 0.9rem;
    }
    button.remove-btn {
      padding: 2px 6px;
      font-size: 0.8rem;
      margin-left: 6px;
    }
  }
</style>
</head>
<body data-theme="light">
  <button id="themeToggleBtn" aria-label="„ÉÜ„Éº„ÉûÂàá„ÇäÊõø„Åà" title="„ÉÜ„Éº„ÉûÂàá„ÇäÊõø„Åà">üåô</button>
  <div id="app" role="application" aria-label="Êó•‰ªòË®àÁÆó„ÉÑ„Éº„É´">
    <header>Êó•‰ªòË®àÁÆó„ÉÑ„Éº„É´</header>
    <div class="date-input">
      <input type="date" id="dateInput" aria-label="Êó•‰ªòÂÖ•Âäõ" />
      <button class="add-btn" id="addDateBtn" aria-label="Êó•‰ªò„ÇíËøΩÂä†">ËøΩÂä†</button>
    </div>
    <div class="date-list" id="dateList" aria-label="ËøΩÂä†„Åï„Çå„ÅüÊó•‰ªò‰∏ÄË¶ß" tabindex="0" role="listbox"></div>
    <div class="date-diff" id="dateDiffList" aria-label="Êó•‰ªòÂ∑ÆÂàÜ‰∏ÄË¶ß"></div>
  </div>
<script>
  (function(){
    const dateInput = document.getElementById('dateInput');
    const addDateBtn = document.getElementById('addDateBtn');
    const dateList = document.getElementById('dateList');
    const dateDiffList = document.getElementById('dateDiffList');
    const themeToggleBtn = document.getElementById('themeToggleBtn');
    const bodyEl = document.body;

    let dates = [];

    // ÊõúÊó•ÂêçÔºàÊó•ÊõúËµ∑ÁÇπÔºâ
    const weekNames = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];

    // Êó•‰ªòË°®Á§∫ÔºöYYYY-MM-DD ‚Üí YYYYÂπ¥MMÊúàDDÊó•(Êõú)
    function formatDisplayDate(dateStr){
      const d = new Date(dateStr + 'T00:00:00');
      if(isNaN(d.getTime())) return '';
      return `${d.getFullYear()}Âπ¥${(d.getMonth()+1).toString().padStart(2,'0')}Êúà${d.getDate().toString().padStart(2,'0')}Êó•Ôºà${weekNames[d.getDay()]}Ôºâ`;
    }

    // Êó•‰ªòÂ∑ÆÂàÜÔºàÊó•Êï∞Ôºâ
    function diffDays(dateStr1, dateStr2){
      const d1 = new Date(dateStr1 + 'T00:00:00');
      const d2 = new Date(dateStr2 + 'T00:00:00');
      if(isNaN(d1.getTime()) || isNaN(d2.getTime())) return null;
      const diff = Math.abs(d2.getTime() - d1.getTime());
      return Math.floor(diff / (1000*60*60*24));
    }

    // ÂàùÊúü„ÉÜ„Éº„ÉûË®≠ÂÆö
    function loadTheme() {
      const stored = localStorage.getItem('tb_theme');
      if(stored === 'dark' || stored === 'light') return stored;
      if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) return 'dark';
      return 'light';
    }
    function applyTheme(theme){
      bodyEl.setAttribute('data-theme', theme);
      themeToggleBtn.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }
    themeToggleBtn.addEventListener('click', () => {
      const current = bodyEl.getAttribute('data-theme');
      const newTheme = current === 'dark' ? 'light' : 'dark';
      applyTheme(newTheme);
      localStorage.setItem('tb_theme', newTheme);
    });

    // Êó•‰ªòËøΩÂä†
    function addDate(){
      const val = dateInput.value;
      if(!val){
        alert('ÊúâÂäπ„Å™Êó•‰ªò„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
      }
      if(dates.includes(val)){
        alert('„Åô„Åß„Å´ËøΩÂä†Ê∏à„Åø„ÅÆÊó•‰ªò„Åß„Åô');
        return;
      }
      dates.push(val);
      dates.sort((a,b) => new Date(a) - new Date(b));
      renderDates();
      renderDiffs();
    }
    // Êó•‰ªòÂâäÈô§
    function removeDate(dateStr){
      dates = dates.filter(d => d !== dateStr);
      renderDates();
      renderDiffs();
    }
    // Êó•‰ªò‰∏ÄË¶ßÊèèÁîª
    function renderDates(){
      dateList.innerHTML = '';
      if(dates.length === 0){
        const empty = document.createElement('div');
        empty.textContent = 'Êó•‰ªò„ÅåËøΩÂä†„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì';
        empty.style.textAlign = 'center';
        empty.style.color = '#a1a6c9';
        dateList.appendChild(empty);
        return;
      }
      dates.forEach(d => {
        const item = document.createElement('div');
        item.className = 'date-item';
        const textSpan = document.createElement('span');
        textSpan.textContent = formatDisplayDate(d);
        const delBtn = document.createElement('button');
        delBtn.className = 'remove-btn';
        delBtn.textContent = 'ÂâäÈô§';
        delBtn.setAttribute('aria-label', `${formatDisplayDate(d)} „ÇíÂâäÈô§`);
        delBtn.addEventListener('click', () => removeDate(d));
        item.appendChild(textSpan);
        item.appendChild(delBtn);
        dateList.appendChild(item);
      });
    }
    // Â∑ÆÂàÜÊèèÁîª
    function renderDiffs(){
      dateDiffList.innerHTML = '';
      if(dates.length < 2){
        dateDiffList.textContent = '2„Å§‰ª•‰∏ä„ÅÆÊó•‰ªò„ÇíËøΩÂä†„Åô„Çã„Å®Êó•Êï∞Â∑Æ„ÇíË®àÁÆó„Åó„Åæ„Åô';
        return;
      }
      for(let i=0; i < dates.length -1; i++){
        const d1 = dates[i];
        const d2 = dates[i+1];
        const diff = diffDays(d1, d2);
        const diffText = document.createElement('div');
        diffText.className = 'date-diff-item';
        diffText.textContent = `${formatDisplayDate(d1)} ÔΩû ${formatDisplayDate(d2)} „ÅØ ${diff} Êó•Â∑Æ„Åß„Åô`;
        dateDiffList.appendChild(diffText);
      }
    }
    // „Ç§„Éô„É≥„Éà„Éê„Ç§„É≥„Éâ
    addDateBtn.addEventListener('click', addDate);
    dateInput.addEventListener('keydown', e => {
      if(e.key === 'Enter'){
        e.preventDefault();
        addDate();
      }
    });

    applyTheme(loadTheme());
    // ÂàùÊúüÂÄ§„Çª„ÉÉ„Éà
    const today = new Date();
    const y = today.getFullYear();
    const m = String(today.getMonth() + 1).padStart(2,'0');
    const d = String(today.getDate()).padStart(2,'0');
    dateInput.value = `${y}-${m}-${d}`;
    renderDates();
    renderDiffs();
  })();
</script>
</body>
</html>
